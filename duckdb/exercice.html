
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://florentfougeres.github.io/cours/duckdb/exercice.html">
      
      
        <link rel="prev" href="presentation.html">
      
      
      
        
      
      
      <link rel="icon" href="../assets/img/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Exercice - Cours - Florent Fougères</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#traitement-de-donnees-geospatiales-duckdb" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Cours - Florent Fougères" class="md-header__button md-logo" aria-label="Cours - Florent Fougères" data-md-component="logo">
      
  <img src="../assets/img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cours - Florent Fougères
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Exercice
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Passer en mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer en mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Passer en mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer en mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/florentfougeres/cours" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    cours
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        
  
  
    
  
  Accueil

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="presentation.html" class="md-tabs__link">
          
  
  
  DuckDB

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Cours - Florent Fougères" class="md-nav__button md-logo" aria-label="Cours - Florent Fougères" data-md-component="logo">
      
  <img src="../assets/img/logo.png" alt="logo">

    </a>
    Cours - Florent Fougères
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/florentfougeres/cours" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    cours
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    DuckDB
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    DuckDB
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="presentation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Présentation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Exercice
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="exercice.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Exercice
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#la-presentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        La présentation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercice-1-introduction-avec-la-cli-duckdb" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercice 1 : Introduction avec la CLI DuckDB
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exercice 1 : Introduction avec la CLI DuckDB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#telecharger-lexecutable-duckdb" class="md-nav__link">
    <span class="md-ellipsis">
      
        Télécharger l'exécutable DuckDB
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lancer-duckdb-depuis-un-terminal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lancer DuckDB depuis un terminal
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installer-lextension-spatial" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installer l'extension spatial
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creer-une-base-de-donnees" class="md-nav__link">
    <span class="md-ellipsis">
      
        Créer une base de données
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creer-une-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        Créer une table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importer-un-csv-et-creer-la-geometrie" class="md-nav__link">
    <span class="md-ellipsis">
      
        Importer un CSV et créer la géométrie
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercice-2-recuperer-des-donnees-et-effectuer-nos-premiers-traitements-geographiques" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercice 2 : Récupérer des données et effectuer nos premiers traitements géographiques
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exercice 2 : Récupérer des données et effectuer nos premiers traitements géographiques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lancer-linterface-web-de-duckdb" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lancer l'interface web de DuckDB
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recuperer-et-explorer-des-donnees-au-format-parquet" class="md-nav__link">
    <span class="md-ellipsis">
      
        Récupérer et explorer des données au format Parquet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creer-une-table-a-partir-dun-fichier-parquet" class="md-nav__link">
    <span class="md-ellipsis">
      
        Créer une table à partir d'un fichier Parquet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utiliser-les-fonctions-spatiales-de-duckdb" class="md-nav__link">
    <span class="md-ellipsis">
      
        Utiliser les fonctions spatiales de DuckDB
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utiliser les fonctions spatiales de DuckDB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-1-creer-la-colonne-et-la-mettre-a-jour-ensuite" class="md-nav__link">
    <span class="md-ellipsis">
      
        Option 1 : créer la colonne et la mettre à jour ensuite
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-2-nouvelle-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        Option 2 : nouvelle table
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercice-3-utiliser-le-plugin-qgis-et-visualiser-nos-donnees" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercice 3 : Utiliser le plugin QGIS et visualiser nos données
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exercice 3 : Utiliser le plugin QGIS et visualiser nos données">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installer-le-plugin-qgis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installer le plugin QGIS
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualiser-dans-qgis-les-couches-realisees-dans-les-exercices-1-et-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Visualiser dans QGIS les couches réalisées dans les exercices 1 et 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#executer-des-selections-sql-depuis-le-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exécuter des sélections SQL depuis le plugin
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exécuter des sélections SQL depuis le plugin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chargement-des-villes-du-departement-35" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chargement des villes du département 35
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chargement-dune-couche-de-buffer-autour-des-points" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chargement d'une couche de buffer autour des points
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercice-4-traiter-des-donnees-parquet-doverture-maps-avec-duckdb" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercice 4 : Traiter des données parquet d'Overture Maps avec DuckDB
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exercice 4 : Traiter des données parquet d&#39;Overture Maps avec DuckDB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#importer-les-donnees-dans-la-base" class="md-nav__link">
    <span class="md-ellipsis">
      
        Importer les données dans la base
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convertir-les-donnees-en-un-geojson-en-utilisant-duckdb" class="md-nav__link">
    <span class="md-ellipsis">
      
        Convertir les données en un GeoJSON en utilisant DuckDB
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercice-5-duckdb-avec-lopen-data-de-rennes-metropole" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercice 5 : DuckDB avec l'Open Data de Rennes Métropole
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exercice 5 : DuckDB avec l&#39;Open Data de Rennes Métropole">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#correction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Correction
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="traitement-de-donnees-geospatiales-duckdb">Traitement de données géospatiales DuckDB</h1>
<h2 id="la-presentation">La présentation</h2>
<iframe src="presentation.pdf" width="100%" height="600px"></iframe>

<h2 id="exercice-1-introduction-avec-la-cli-duckdb">Exercice 1 : Introduction avec la CLI DuckDB</h2>
<h3 id="telecharger-lexecutable-duckdb">Télécharger l'exécutable DuckDB</h3>
<p>Depuis le <a href="https://duckdb.org/install/?platform=windows&amp;environment=cli">site officiel</a></p>
<p><img alt="Téléchargement de l'exécutable" src="img/cli.png" /></p>
<h3 id="lancer-duckdb-depuis-un-terminal">Lancer DuckDB depuis un terminal</h3>
<p>Il faut, depuis un terminal, se placer dans le dossier où vous avez téléchargé l'exécutable, par exemple :</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>C:<span class="se">\U</span>sers<span class="se">\f</span>lorent<span class="se">\</span>
</code></pre></div>
<p>Puis lancer l'exécutable :</p>
<div class="highlight"><pre><span></span><code>duckdb.exe
</code></pre></div>
<p>On arrive alors dans la console DuckDB (équivalent de psql) où l'on peut taper du SQL.</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">number</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;a&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">letter</span><span class="w"> </span><span class="p">;</span><span class="w"> </span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Avant d'appuyer sur Entrée, il faut toujours terminer l'instruction SQL par un point-virgule <code>;</code></p>
</div>
<h3 id="installer-lextension-spatial">Installer l'extension spatial</h3>
<div class="highlight"><pre><span></span><code><span class="n">INSTALL</span><span class="w"> </span><span class="n">spatial</span><span class="p">;</span><span class="w"> </span>
</code></pre></div>
<p>Puis charger l'extension :</p>
<div class="highlight"><pre><span></span><code><span class="k">LOAD</span><span class="w"> </span><span class="n">spatial</span><span class="p">;</span>
</code></pre></div>
<blockquote>
<p>La documentation de l'extension spatial se trouve sur cette <a href="https://duckdb.org/docs/stable/core_extensions/spatial/overview">page</a>, on y retrouve la liste des <a href="https://duckdb.org/docs/stable/core_extensions/spatial/functions">fonctions</a> disponibles.</p>
</blockquote>
<h3 id="creer-une-base-de-donnees">Créer une base de données</h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Actuellement nous sommes dans une base temporaire, tout ce que nous exécutons ne sera pas sauvegardé. Il faut donc créer une base de données pour conserver notre travail.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="p">.</span><span class="k">open</span><span class="w"> </span><span class="k">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">florent</span><span class="err">\</span><span class="n">chemin</span><span class="err">\</span><span class="n">vers</span><span class="err">\</span><span class="n">ma</span><span class="err">\</span><span class="n">base</span><span class="p">.</span><span class="n">duckdb</span>
</code></pre></div>
<h3 id="creer-une-table">Créer une table</h3>
<p>Cette <a href="https://duckdb.org/docs/stable/sql/statements/create_table">page</a> de la documentation montre des exemples.</p>
<p>On va créer une table nommée <code>ville</code> avec plusieurs champs : <code>id</code> sera notre clé primaire et s'auto-incrémentera, <code>nom</code> sera de type <code>VARCHAR</code> et <code>geom</code> sera un champ géométrique.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Attention, les colonnes de géométrie n'ont pas de type.
Une des particularités des colonnes de géométrie dans DuckDB spatial est l'absence de définition du type de géométrie (contrairement à PostGIS par exemple). Une même colonne de géométrie peut contenir aussi bien des points, des lignes, des polygones, etc. Il est donc possible de mélanger des points et des lignes dans une même table, mais même si c'est techniquement possible, je vous le déconseille.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="n">SEQUENCE</span><span class="w"> </span><span class="n">seq_ville</span><span class="w"> </span><span class="k">START</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ville</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w">   </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;seq_ville&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">nom</span><span class="w">  </span><span class="nb">VARCHAR</span><span class="p">,</span>
<span class="w">    </span><span class="n">geom</span><span class="w"> </span><span class="n">GEOMETRY</span>
<span class="p">);</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Pour rappel, une colonne de géométrie n'a pas de système de projection dans sa définition. En conséquence, il n'y a :
- pas de définition de projection comme contrainte pour une colonne
- pas d'attribution d'une projection lors d'un export</p>
</div>
<p>La commande <code>DESCRIBE</code> permet d'obtenir la description de la structure d'une table.</p>
<div class="highlight"><pre><span></span><code><span class="n">D</span><span class="w"> </span><span class="k">describe</span><span class="w"> </span><span class="n">ville</span><span class="w"> </span><span class="p">;</span><span class="w"> </span>
<span class="err">┌─────────────┬─────────────┬─────────┬─────────┬─────────┬─────────┐</span>
<span class="err">│</span><span class="w"> </span><span class="k">column_name</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">column_type</span><span class="w"> </span><span class="err">│</span><span class="w">  </span><span class="k">null</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="k">key</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="err">│</span><span class="w">  </span><span class="n">extra</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">   </span><span class="nb">varchar</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="nb">varchar</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nb">varchar</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">varchar</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">varchar</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">varchar</span><span class="w"> </span><span class="err">│</span>
<span class="err">├─────────────┼─────────────┼─────────┼─────────┼─────────┼─────────┤</span>
<span class="err">│</span><span class="w"> </span><span class="n">id</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NO</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="n">PRI</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">nom</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">geom</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">GEOMETRY</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">└─────────────┴─────────────┴─────────┴─────────┴─────────┴─────────┘</span>
</code></pre></div>
<p>La commande <code>SHOW TABLES</code> permet de lister les tables.</p>
<div class="highlight"><pre><span></span><code><span class="n">D</span><span class="w"> </span><span class="k">SHOW</span><span class="w"> </span><span class="n">TABLES</span><span class="w"> </span><span class="p">;</span><span class="w"> </span>
<span class="err">┌─────────┐</span>
<span class="err">│</span><span class="w">  </span><span class="n">name</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="nb">varchar</span><span class="w"> </span><span class="err">│</span>
<span class="err">├─────────┤</span>
<span class="err">│</span><span class="w"> </span><span class="n">ville</span><span class="w">   </span><span class="err">│</span>
<span class="err">└─────────┘</span>
</code></pre></div>
<p>On va maintenant insérer des données dans notre table.</p>
<div class="highlight"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">ville</span><span class="w"> </span><span class="p">(</span><span class="n">nom</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span>
<span class="w">    </span><span class="p">(</span><span class="s1">&#39;Rennes&#39;</span><span class="p">,</span><span class="w">    </span><span class="n">ST_GeomFromText</span><span class="p">(</span><span class="s1">&#39;POINT(-1.6778 48.1173)&#39;</span><span class="p">)),</span>
<span class="w">    </span><span class="p">(</span><span class="s1">&#39;Marseille&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_GeomFromText</span><span class="p">(</span><span class="s1">&#39;POINT(5.3698 43.2965)&#39;</span><span class="p">)),</span>
<span class="w">    </span><span class="p">(</span><span class="s1">&#39;Laval&#39;</span><span class="p">,</span><span class="w">     </span><span class="n">ST_GeomFromText</span><span class="p">(</span><span class="s1">&#39;POINT(-0.7667 48.0667)&#39;</span><span class="p">));</span>
</code></pre></div>
<p>Regardons le résultat.</p>
<div class="highlight"><pre><span></span><code><span class="n">D</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">ville</span><span class="w"> </span><span class="p">;</span><span class="w"> </span>
<span class="err">┌───────┬───────────┬─────────────────────────┐</span>
<span class="err">│</span><span class="w">  </span><span class="n">id</span><span class="w">   </span><span class="err">│</span><span class="w">    </span><span class="n">nom</span><span class="w">    </span><span class="err">│</span><span class="w">          </span><span class="n">geom</span><span class="w">           </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">int32</span><span class="w"> </span><span class="err">│</span><span class="w">  </span><span class="nb">varchar</span><span class="w">  </span><span class="err">│</span><span class="w">        </span><span class="n">geometry</span><span class="w">         </span><span class="err">│</span>
<span class="err">├───────┼───────────┼─────────────────────────┤</span>
<span class="err">│</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">Rennes</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">6778</span><span class="w"> </span><span class="mi">48</span><span class="p">.</span><span class="mi">1173</span><span class="p">)</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="mi">2</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">Marseille</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">.</span><span class="mi">3698</span><span class="w"> </span><span class="mi">43</span><span class="p">.</span><span class="mi">2965</span><span class="p">)</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">     </span><span class="mi">3</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">Laval</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">7667</span><span class="w"> </span><span class="mi">48</span><span class="p">.</span><span class="mi">0667</span><span class="p">)</span><span class="w"> </span><span class="err">│</span>
<span class="err">└───────┴───────────┴─────────────────────────┘</span>
</code></pre></div>
<h3 id="importer-un-csv-et-creer-la-geometrie">Importer un CSV et créer la géométrie</h3>
<div class="admonition info lire un csv">
<p class="admonition-title">Info</p>
<p>La fonction <code>read_csv_auto</code> nous permet d'importer un CSV sans avoir à créer la table au préalable. Cette fonction détecte automatiquement la structure du CSV.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">airports</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">read_csv_auto</span><span class="p">(</span><span class="s1">&#39;https://davidmegginson.github.io/ourairports-data/airports.csv&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">HEADER</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="w"> </span><span class="n">DELIM</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">;</span>
</code></pre></div>
<p>Il faut maintenant ajouter une colonne de géométrie à notre table.</p>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">airports</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">the_geom</span><span class="w"> </span><span class="n">GEOMETRY</span><span class="w"> </span><span class="p">;</span>
</code></pre></div>
<p>Puis on met à jour cette colonne en créant un point à partir des colonnes <code>longitude_deg</code> et <code>latitude_deg</code> :</p>
<div class="highlight"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">airports</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">the_geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ST_POINT</span><span class="p">(</span><span class="n">longitude_deg</span><span class="p">,</span><span class="w"> </span><span class="n">latitude_deg</span><span class="p">)</span><span class="w"> </span><span class="p">;</span>
</code></pre></div>
<h2 id="exercice-2-recuperer-des-donnees-et-effectuer-nos-premiers-traitements-geographiques">Exercice 2 : Récupérer des données et effectuer nos premiers traitements géographiques</h2>
<h3 id="lancer-linterface-web-de-duckdb">Lancer l'interface web de DuckDB</h3>
<div class="admonition tip on va sortir du terminal">
<p class="admonition-title">Tip</p>
<p>Pour un peu plus de confort, on va réaliser cet exercice dans l'interface web fournie avec l'exécutable DuckDB, l'équivalent de <code>PgAdmin</code> pour DuckDB.</p>
</div>
<p>Il faut, depuis un terminal, se placer dans le dossier où vous avez téléchargé l'exécutable, par exemple :</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>C:<span class="se">\U</span>sers<span class="se">\f</span>lorent<span class="se">\</span>
</code></pre></div>
<p>Puis lancer l'exécutable avec l'option <code>-ui</code> :</p>
<div class="highlight"><pre><span></span><code>duckdb.exe<span class="w"> </span>-ui
</code></pre></div>
<p>Une fenêtre va s'ouvrir dans votre navigateur web à l'adresse <code>http://localhost:4213/</code></p>
<p><img alt="alt text" src="img/ui.png" /></p>
<p>Une fois dans cette interface, on peut de nouveau se connecter à la base de données créée lors de l'exercice 1.</p>
<h3 id="recuperer-et-explorer-des-donnees-au-format-parquet">Récupérer et explorer des données au format Parquet</h3>
<p>Nous allons utiliser ce jeu de données : https://public.opendatasoft.com/explore/assets/geonames-all-cities-with-a-population-1000/</p>
<p>Depuis l'onglet <code>export</code>, on peut récupérer l'URL du fichier Parquet.</p>
<div class="highlight"><pre><span></span><code>https://public.opendatasoft.com/api/explore/v2.1/catalog/datasets/geonames-all-cities-with-a-population-1000/exports/parquet/?lang=fr&amp;timezone=Europe%2FParis
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Nous n'avons pas besoin de télécharger le fichier, nous allons directement fournir l'URL du fichier Parquet dans notre requête.</p>
</div>
<p>Pour lire un fichier distant, il est nécessaire de charger une autre extension :</p>
<div class="highlight"><pre><span></span><code><span class="k">load</span><span class="w"> </span><span class="n">httpfs</span><span class="w"> </span><span class="p">;</span>
</code></pre></div>
<p>On regarde à quoi ressemblent nos données :</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;https://public.opendatasoft.com/api/explore/v2.1/catalog/datasets/geonames-all-cities-with-a-population-1000/exports/parquet/?lang=fr&amp;timezone=Europe%2FParis&#39;</span><span class="p">)</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="err">┌────────────┬──────────────────────┬──────────────────────┬──────────────────────┬───────────────┬──────────────┬───┬───────────┬───────┬─────────────────────┬───────────────────┬────────────────────┬──────────────────────┐</span>
<span class="err">│</span><span class="w"> </span><span class="n">geoname_id</span><span class="w"> </span><span class="err">│</span><span class="w">         </span><span class="n">name</span><span class="w">         </span><span class="err">│</span><span class="w">      </span><span class="n">ascii_name</span><span class="w">      </span><span class="err">│</span><span class="w">   </span><span class="n">alternate_names</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">feature_class</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">feature_code</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">elevation</span><span class="w"> </span><span class="err">│</span><span class="w">  </span><span class="n">dem</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="n">timezone</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="n">modification_date</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="n">label_en</span><span class="w">      </span><span class="err">│</span><span class="w">     </span><span class="n">coordinates</span><span class="w">      </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nb">varchar</span><span class="w">   </span><span class="err">│</span><span class="w">       </span><span class="nb">varchar</span><span class="w">        </span><span class="err">│</span><span class="w">       </span><span class="nb">varchar</span><span class="w">        </span><span class="err">│</span><span class="w">       </span><span class="nb">varchar</span><span class="w">        </span><span class="err">│</span><span class="w">    </span><span class="nb">varchar</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="nb">varchar</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">  </span><span class="nb">varchar</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">int64</span><span class="w"> </span><span class="err">│</span><span class="w">       </span><span class="nb">varchar</span><span class="w">       </span><span class="err">│</span><span class="w">       </span><span class="nb">date</span><span class="w">        </span><span class="err">│</span><span class="w">      </span><span class="nb">varchar</span><span class="w">       </span><span class="err">│</span><span class="w">         </span><span class="nb">blob</span><span class="w">         </span><span class="err">│</span>
<span class="err">├────────────┼──────────────────────┼──────────────────────┼──────────────────────┼───────────────┼──────────────┼───┼───────────┼───────┼─────────────────────┼───────────────────┼────────────────────┼──────────────────────┤</span>
<span class="err">│</span><span class="w"> </span><span class="mi">696359</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">Peredmistna</span><span class="w"> </span><span class="n">Slobidka</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">Peredmistna</span><span class="w"> </span><span class="n">Slobidka</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">Predmostnaya</span><span class="p">,</span><span class="n">Predm</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPL</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">   </span><span class="mi">101</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">Europe</span><span class="o">/</span><span class="n">Kyiv</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">19</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">Ukraine</span><span class="w">            </span><span class="err">│</span><span class="w"> </span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">12495567</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">Harbour</span><span class="w"> </span><span class="n">Main</span><span class="o">-</span><span class="n">Chape</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">Harbour</span><span class="w"> </span><span class="n">Main</span><span class="o">-</span><span class="n">Chape</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">                 </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPL</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">    </span><span class="mi">54</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">America</span><span class="o">/</span><span class="n">St_Johns</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">21</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">Canada</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">4003914</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">J</span><span class="p">.</span><span class="w"> </span><span class="n">Jesús</span><span class="w"> </span><span class="n">Díaz</span><span class="w"> </span><span class="n">Tzirio</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">J</span><span class="p">.</span><span class="w"> </span><span class="n">Jesus</span><span class="w"> </span><span class="n">Diaz</span><span class="w"> </span><span class="n">Tzirio</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">                 </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPL</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">  </span><span class="mi">2257</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">America</span><span class="o">/</span><span class="n">Mexico_City</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">2013</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">01</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">Mexico</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">906044</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">Monze</span><span class="w">                </span><span class="err">│</span><span class="w"> </span><span class="n">Monze</span><span class="w">                </span><span class="err">│</span><span class="w"> </span><span class="n">Monze</span><span class="w">                </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPL</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">  </span><span class="mi">1124</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">Africa</span><span class="o">/</span><span class="n">Lusaka</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">02</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">Zambia</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">8859205</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">Loma</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">los</span><span class="w"> </span><span class="n">Hoyos</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">Loma</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">los</span><span class="w"> </span><span class="n">Hoyos</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">Loma</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">los</span><span class="w"> </span><span class="n">Hoyos</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPL</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">   </span><span class="mi">242</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">America</span><span class="o">/</span><span class="n">Mexico_City</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">11</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">Mexico</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">13513017</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">South</span><span class="w"> </span><span class="n">Westminster</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">South</span><span class="w"> </span><span class="n">Westminster</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">                 </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPLX</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">    </span><span class="mi">22</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">America</span><span class="o">/</span><span class="n">Vancouver</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">08</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">Canada</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">13527032</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">Anse</span><span class="w"> </span><span class="n">Royale</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="n">Anse</span><span class="w"> </span><span class="n">Royale</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">                 </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPLX</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">     </span><span class="mi">4</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">Indian</span><span class="o">/</span><span class="n">Mahe</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">Seychelles</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">2017537</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">Putyatin</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">Putyatin</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">Putjatin</span><span class="p">,</span><span class="n">Putyatin</span><span class="p">,</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPL</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">    </span><span class="mi">14</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">Asia</span><span class="o">/</span><span class="n">Vladivostok</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">20</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">Russian</span><span class="w"> </span><span class="n">Federation</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">13191985</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Villas</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">Aeloa</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Villas</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">Aeloa</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">Aeloa</span><span class="p">,</span><span class="n">Kapolei</span><span class="w"> </span><span class="n">Aelo</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPLX</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">    </span><span class="mi">27</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">Pacific</span><span class="o">/</span><span class="n">Honolulu</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">13</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">United</span><span class="w"> </span><span class="n">States</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">4295940</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">Ironville</span><span class="w">            </span><span class="err">│</span><span class="w"> </span><span class="n">Ironville</span><span class="w">            </span><span class="err">│</span><span class="w"> </span><span class="n">Ironville</span><span class="p">,</span><span class="n">ai</span><span class="w"> </span><span class="n">en</span><span class="w"> </span><span class="n">we</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPL</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">219</span><span class="w">       </span><span class="err">│</span><span class="w">   </span><span class="mi">221</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">America</span><span class="o">/</span><span class="n">New_York</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="mi">2012</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">14</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">United</span><span class="w"> </span><span class="n">States</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x01</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x00</span><span class="err">\</span><span class="n">x</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴───────────────┴──────────────┴───┴───────────┴───────┴─────────────────────┴───────────────────┴────────────────────┴──────────────────────┤</span>
<span class="err">│</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">rows</span><span class="w">                                                                                                                                                                                                </span><span class="mi">20</span><span class="w"> </span><span class="n">columns</span><span class="w"> </span><span class="p">(</span><span class="mi">12</span><span class="w"> </span><span class="n">shown</span><span class="p">)</span><span class="w"> </span><span class="err">│</span>
<span class="err">└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Je n'ai pas fait le <code>load spatial</code>, donc la colonne de géométrie est mal interprétée : elle est de type blob. </p>
</div>
<p>Après avoir refait le <code>load spatial</code>, j'obtiens une colonne de géométrie bien interprétée.</p>
<div class="highlight"><pre><span></span><code><span class="err">┌────────────┬──────────────────────┬──────────────────────┬──────────────────────┬───────────────┬──────────────┬───┬───────────┬───────┬─────────────────────┬───────────────────┬────────────────────┬──────────────────────┐</span>
<span class="err">│</span><span class="w"> </span><span class="n">geoname_id</span><span class="w"> </span><span class="err">│</span><span class="w">         </span><span class="n">name</span><span class="w">         </span><span class="err">│</span><span class="w">      </span><span class="n">ascii_name</span><span class="w">      </span><span class="err">│</span><span class="w">   </span><span class="n">alternate_names</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">feature_class</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">feature_code</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">elevation</span><span class="w"> </span><span class="err">│</span><span class="w">  </span><span class="n">dem</span><span class="w">  </span><span class="err">│</span><span class="w">      </span><span class="n">timezone</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="n">modification_date</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="n">label_en</span><span class="w">      </span><span class="err">│</span><span class="w">     </span><span class="n">coordinates</span><span class="w">      </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nb">varchar</span><span class="w">   </span><span class="err">│</span><span class="w">       </span><span class="nb">varchar</span><span class="w">        </span><span class="err">│</span><span class="w">       </span><span class="nb">varchar</span><span class="w">        </span><span class="err">│</span><span class="w">       </span><span class="nb">varchar</span><span class="w">        </span><span class="err">│</span><span class="w">    </span><span class="nb">varchar</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="nb">varchar</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">  </span><span class="nb">varchar</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">int64</span><span class="w"> </span><span class="err">│</span><span class="w">       </span><span class="nb">varchar</span><span class="w">       </span><span class="err">│</span><span class="w">       </span><span class="nb">date</span><span class="w">        </span><span class="err">│</span><span class="w">      </span><span class="nb">varchar</span><span class="w">       </span><span class="err">│</span><span class="w">       </span><span class="n">geometry</span><span class="w">       </span><span class="err">│</span>
<span class="err">├────────────┼──────────────────────┼──────────────────────┼──────────────────────┼───────────────┼──────────────┼───┼───────────┼───────┼─────────────────────┼───────────────────┼────────────────────┼──────────────────────┤</span>
<span class="err">│</span><span class="w"> </span><span class="mi">696359</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">Peredmistna</span><span class="w"> </span><span class="n">Slobidka</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">Peredmistna</span><span class="w"> </span><span class="n">Slobidka</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">Predmostnaya</span><span class="p">,</span><span class="n">Predm</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPL</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">   </span><span class="mi">101</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">Europe</span><span class="o">/</span><span class="n">Kyiv</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">19</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">Ukraine</span><span class="w">            </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="mi">30</span><span class="p">.</span><span class="mi">58333</span><span class="w"> </span><span class="mi">50</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">12495567</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">Harbour</span><span class="w"> </span><span class="n">Main</span><span class="o">-</span><span class="n">Chape</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">Harbour</span><span class="w"> </span><span class="n">Main</span><span class="o">-</span><span class="n">Chape</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">                 </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPL</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">    </span><span class="mi">54</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">America</span><span class="o">/</span><span class="n">St_Johns</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">21</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">Canada</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">53</span><span class="p">.</span><span class="mi">1744</span><span class="w"> </span><span class="mi">47</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">4003914</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">J</span><span class="p">.</span><span class="w"> </span><span class="n">Jesús</span><span class="w"> </span><span class="n">Díaz</span><span class="w"> </span><span class="n">Tzirio</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">J</span><span class="p">.</span><span class="w"> </span><span class="n">Jesus</span><span class="w"> </span><span class="n">Diaz</span><span class="w"> </span><span class="n">Tzirio</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">                 </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPL</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">  </span><span class="mi">2257</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">America</span><span class="o">/</span><span class="n">Mexico_City</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">2013</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">01</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">Mexico</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">102</span><span class="p">.</span><span class="mi">39722</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">906044</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">Monze</span><span class="w">                </span><span class="err">│</span><span class="w"> </span><span class="n">Monze</span><span class="w">                </span><span class="err">│</span><span class="w"> </span><span class="n">Monze</span><span class="w">                </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPL</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">  </span><span class="mi">1124</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">Africa</span><span class="o">/</span><span class="n">Lusaka</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">02</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">Zambia</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="mi">27</span><span class="p">.</span><span class="mi">48333</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">8859205</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">Loma</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">los</span><span class="w"> </span><span class="n">Hoyos</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">Loma</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">los</span><span class="w"> </span><span class="n">Hoyos</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">Loma</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">los</span><span class="w"> </span><span class="n">Hoyos</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPL</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">   </span><span class="mi">242</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">America</span><span class="o">/</span><span class="n">Mexico_City</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">11</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">Mexico</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">102</span><span class="p">.</span><span class="mi">44278</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">13513017</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">South</span><span class="w"> </span><span class="n">Westminster</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">South</span><span class="w"> </span><span class="n">Westminster</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">                 </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPLX</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">    </span><span class="mi">22</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">America</span><span class="o">/</span><span class="n">Vancouver</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">08</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">Canada</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">122</span><span class="p">.</span><span class="mi">87861</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">13527032</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">Anse</span><span class="w"> </span><span class="n">Royale</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="n">Anse</span><span class="w"> </span><span class="n">Royale</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">                 </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPLX</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">     </span><span class="mi">4</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">Indian</span><span class="o">/</span><span class="n">Mahe</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">02</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">Seychelles</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="mi">55</span><span class="p">.</span><span class="mi">50333</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">2017537</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">Putyatin</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">Putyatin</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">Putjatin</span><span class="p">,</span><span class="n">Putyatin</span><span class="p">,</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPL</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">    </span><span class="mi">14</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">Asia</span><span class="o">/</span><span class="n">Vladivostok</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="mi">2024</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">20</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">Russian</span><span class="w"> </span><span class="n">Federation</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="mi">132</span><span class="p">.</span><span class="mi">41599</span><span class="w"> </span><span class="mi">4</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">13191985</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Villas</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">Aeloa</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Villas</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">Aeloa</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">Aeloa</span><span class="p">,</span><span class="n">Kapolei</span><span class="w"> </span><span class="n">Aelo</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPLX</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w">    </span><span class="mi">27</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">Pacific</span><span class="o">/</span><span class="n">Honolulu</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="mi">2025</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">13</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">United</span><span class="w"> </span><span class="n">States</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">158</span><span class="p">.</span><span class="mi">06726</span><span class="w"> </span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">4295940</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">Ironville</span><span class="w">            </span><span class="err">│</span><span class="w"> </span><span class="n">Ironville</span><span class="w">            </span><span class="err">│</span><span class="w"> </span><span class="n">Ironville</span><span class="p">,</span><span class="n">ai</span><span class="w"> </span><span class="n">en</span><span class="w"> </span><span class="n">we</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">P</span><span class="w">             </span><span class="err">│</span><span class="w"> </span><span class="n">PPL</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">219</span><span class="w">       </span><span class="err">│</span><span class="w">   </span><span class="mi">221</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">America</span><span class="o">/</span><span class="n">New_York</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="mi">2012</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">14</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">United</span><span class="w"> </span><span class="n">States</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">82</span><span class="p">.</span><span class="mi">69238</span><span class="w"> </span><span class="mi">3</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴───────────────┴──────────────┴───┴───────────┴───────┴─────────────────────┴───────────────────┴────────────────────┴──────────────────────┤</span>
<span class="err">│</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">rows</span><span class="w">                                                                                                                                                                                                </span><span class="mi">20</span><span class="w"> </span><span class="n">columns</span><span class="w"> </span><span class="p">(</span><span class="mi">12</span><span class="w"> </span><span class="n">shown</span><span class="p">)</span><span class="w"> </span><span class="err">│</span>
<span class="err">└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>
<p>On ne va pas garder toutes les colonnes. On va faire un <code>DESCRIBE</code> pour voir ce qui est disponible.</p>
<div class="highlight"><pre><span></span><code><span class="n">D</span><span class="w"> </span><span class="k">DESCRIBE</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;https://public.opendatasoft.com/api/explore/v2.1/catalog/datasets/geonames-all-cities-with-a-population-1000/exports/parquet/?lang=fr&amp;timezone=Europe%2FParis&#39;</span><span class="p">)</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">;</span>
<span class="err">┌───────────────────┬─────────────┬─────────┬─────────┬─────────┬─────────┐</span>
<span class="err">│</span><span class="w">    </span><span class="k">column_name</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">column_type</span><span class="w"> </span><span class="err">│</span><span class="w">  </span><span class="k">null</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="k">key</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="err">│</span><span class="w">  </span><span class="n">extra</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">      </span><span class="nb">varchar</span><span class="w">      </span><span class="err">│</span><span class="w">   </span><span class="nb">varchar</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nb">varchar</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">varchar</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">varchar</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">varchar</span><span class="w"> </span><span class="err">│</span>
<span class="err">├───────────────────┼─────────────┼─────────┼─────────┼─────────┼─────────┤</span>
<span class="err">│</span><span class="w"> </span><span class="n">geoname_id</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">name</span><span class="w">              </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">ascii_name</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">alternate_names</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">feature_class</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">feature_code</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">country_code</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">cou_name_en</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">country_code_2</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">admin1_code</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">admin2_code</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">admin3_code</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="nb">BIGINT</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">admin4_code</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">population</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="nb">BIGINT</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">elevation</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">dem</span><span class="w">               </span><span class="err">│</span><span class="w"> </span><span class="nb">BIGINT</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">timezone</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">modification_date</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">DATE</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">label_en</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">coordinates</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="n">GEOMETRY</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">YES</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">    </span><span class="err">│</span>
<span class="err">├───────────────────┴─────────────┴─────────┴─────────┴─────────┴─────────┤</span>
<span class="err">│</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="k">rows</span><span class="w">                                                       </span><span class="mi">6</span><span class="w"> </span><span class="n">columns</span><span class="w"> </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>En utilisant <code>DESCRIBE</code> de cette manière, on est tout de même obligé de récupérer des données pour obtenir la description de la table. Il existe une méthode plus efficace : la fonction <code>parquet_schema</code>. Cette fonction lit uniquement le <strong>footer du fichier Parquet</strong> (quelques Ko), qui contient le schéma, sans charger les données. Cela fonctionne parfaitement avec des fichiers locaux ou des URLs pointant vers des fichiers Parquet statiques.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="n">D</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">parquet_schema</span><span class="p">(</span><span class="s1">&#39;https://public.opendatasoft.com/api/explore/v2.1/catalog/datasets/geonames-all-cities-with-a-population-1000/exports/parquet/?lang=fr&amp;timezone=Europe%2FParis&#39;</span><span class="p">);</span>
<span class="err">┌───────────────────────────────────────────────────────────────────────────┬───────────────────┬────────────┬─────────────┬─────────────────┬──────────────┬────────────────┬───────┬───────────┬──────────┬──────────────┬─────────────┐</span>
<span class="err">│</span><span class="w">                                 </span><span class="n">file_name</span><span class="w">                                 </span><span class="err">│</span><span class="w">       </span><span class="n">name</span><span class="w">        </span><span class="err">│</span><span class="w">    </span><span class="k">type</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">type_length</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">repetition_type</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">num_children</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">converted_type</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">scale</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">precision</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">field_id</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">logical_type</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">duckdb_type</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w">                                  </span><span class="nb">varchar</span><span class="w">                                  </span><span class="err">│</span><span class="w">      </span><span class="nb">varchar</span><span class="w">      </span><span class="err">│</span><span class="w">  </span><span class="nb">varchar</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="nb">varchar</span><span class="w">   </span><span class="err">│</span><span class="w">     </span><span class="nb">varchar</span><span class="w">     </span><span class="err">│</span><span class="w">    </span><span class="n">int64</span><span class="w">     </span><span class="err">│</span><span class="w">    </span><span class="nb">varchar</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">int64</span><span class="w"> </span><span class="err">│</span><span class="w">   </span><span class="n">int64</span><span class="w">   </span><span class="err">│</span><span class="w">  </span><span class="n">int64</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="nb">varchar</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="nb">varchar</span><span class="w">   </span><span class="err">│</span>
<span class="err">├───────────────────────────────────────────────────────────────────────────┼───────────────────┼────────────┼─────────────┼─────────────────┼──────────────┼────────────────┼───────┼───────────┼──────────┼──────────────┼─────────────┤</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="k">schema</span><span class="w">            </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">REQUIRED</span><span class="w">        </span><span class="err">│</span><span class="w">           </span><span class="mi">20</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">geoname_id</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">BYTE_ARRAY</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UTF8</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">StringType</span><span class="p">()</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">name</span><span class="w">              </span><span class="err">│</span><span class="w"> </span><span class="n">BYTE_ARRAY</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UTF8</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">StringType</span><span class="p">()</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">ascii_name</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">BYTE_ARRAY</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UTF8</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">StringType</span><span class="p">()</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">alternate_names</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">BYTE_ARRAY</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UTF8</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">StringType</span><span class="p">()</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">feature_class</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">BYTE_ARRAY</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UTF8</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">StringType</span><span class="p">()</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">feature_code</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="n">BYTE_ARRAY</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UTF8</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">StringType</span><span class="p">()</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">country_code</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="n">BYTE_ARRAY</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UTF8</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">StringType</span><span class="p">()</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">cou_name_en</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="n">BYTE_ARRAY</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UTF8</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">StringType</span><span class="p">()</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">country_code_2</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">BYTE_ARRAY</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UTF8</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">StringType</span><span class="p">()</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">admin1_code</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="n">BYTE_ARRAY</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UTF8</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">StringType</span><span class="p">()</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">admin2_code</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="n">BYTE_ARRAY</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UTF8</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">StringType</span><span class="p">()</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">admin3_code</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="n">INT64</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="nb">BIGINT</span><span class="w">      </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">admin4_code</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="n">BYTE_ARRAY</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UTF8</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">StringType</span><span class="p">()</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">population</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">INT64</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="nb">BIGINT</span><span class="w">      </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">elevation</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="n">BYTE_ARRAY</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UTF8</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">StringType</span><span class="p">()</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">dem</span><span class="w">               </span><span class="err">│</span><span class="w"> </span><span class="n">INT64</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="nb">BIGINT</span><span class="w">      </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">timezone</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="n">BYTE_ARRAY</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UTF8</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">StringType</span><span class="p">()</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">modification_date</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">INT32</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">DATE</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">DateType</span><span class="p">()</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nb">DATE</span><span class="w">        </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">label_en</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="n">BYTE_ARRAY</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UTF8</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">StringType</span><span class="p">()</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w">     </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="k">public</span><span class="p">.</span><span class="n">opendatasoft</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">explore</span><span class="o">/</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="o">/</span><span class="k">catalog</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">geona</span><span class="err">…</span><span class="w">  </span><span class="err">│</span><span class="w"> </span><span class="n">coordinates</span><span class="w">       </span><span class="err">│</span><span class="w"> </span><span class="n">BYTE_ARRAY</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">OPTIONAL</span><span class="w">        </span><span class="err">│</span><span class="w">         </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">           </span><span class="err">│</span><span class="w">  </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w">     </span><span class="k">NULL</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="nb">BLOB</span><span class="w">        </span><span class="err">│</span>
<span class="err">├───────────────────────────────────────────────────────────────────────────┴───────────────────┴────────────┴─────────────┴─────────────────┴──────────────┴────────────────┴───────┴───────────┴──────────┴──────────────┴─────────────┤</span>
<span class="err">│</span><span class="w"> </span><span class="mi">21</span><span class="w"> </span><span class="k">rows</span><span class="w">                                                                                                                                                                                                                     </span><span class="mi">12</span><span class="w"> </span><span class="n">columns</span><span class="w"> </span><span class="err">│</span>
<span class="err">└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>
<h3 id="creer-une-table-a-partir-dun-fichier-parquet">Créer une table à partir d'un fichier Parquet</h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Attention aux fichiers Parquet distants.
Tous les serveurs ne sont pas compatibles avec les requêtes HTTP Range. Dans ce cas, DuckDB ne peut pas tirer parti du stockage en colonnes pour ne télécharger que ce dont il a besoin — il est forcé de tout récupérer d'un coup, ce qui peut provoquer des erreurs.</p>
<p>La solution est d'utiliser <code>SET force_download=true;</code> pour indiquer à DuckDB de télécharger le fichier en entier avant de l'interroger.</p>
<p><strong>Si le fichier Parquet était en local</strong>, ce problème n'existerait pas : DuckDB lirait directement les colonnes nécessaires sur votre disque, sans contrainte réseau, et profiterait pleinement de tous les avantages du format (column pruning, predicate pushdown...).</p>
<p>Retenez donc que les gains de performance de Parquet sont maximaux quand les fichiers sont <strong>en local ou sur un stockage cloud bien configuré</strong> (S3, GCS, Azure Blob).</p>
</div>
<p>On va donc exécuter <code>SET force_download=true;</code> (sauf si vous avez téléchargé le fichier Parquet en local).</p>
<p>On va créer une table dans notre base en ne gardant que certaines colonnes et les villes françaises.</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">villes_1000_hab_fr</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">geoname_id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">population</span><span class="p">,</span><span class="w"> </span><span class="n">elevation</span><span class="p">,</span><span class="w"> </span><span class="n">coordinates</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;https://public.opendatasoft.com/api/explore/v2.1/catalog/datasets/geonames-all-cities-with-a-population-1000/exports/parquet/?lang=fr&amp;timezone=Europe%2FParis&#39;</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">country_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;FR&#39;</span><span class="w"> </span><span class="p">;</span>
</code></pre></div>
<p>On vérifie qu'on a bien récupéré des données :</p>
<div class="highlight"><pre><span></span><code><span class="n">D</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">villes_1000_hab_fr</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">;</span>
<span class="err">┌────────────┬────────────────────────┬────────────┬───────────┬───────────────────────────┐</span>
<span class="err">│</span><span class="w"> </span><span class="n">geoname_id</span><span class="w"> </span><span class="err">│</span><span class="w">          </span><span class="n">name</span><span class="w">          </span><span class="err">│</span><span class="w"> </span><span class="n">population</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">elevation</span><span class="w"> </span><span class="err">│</span><span class="w">        </span><span class="n">coordinates</span><span class="w">        </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nb">varchar</span><span class="w">   </span><span class="err">│</span><span class="w">        </span><span class="nb">varchar</span><span class="w">         </span><span class="err">│</span><span class="w">   </span><span class="n">int64</span><span class="w">    </span><span class="err">│</span><span class="w">  </span><span class="nb">varchar</span><span class="w">  </span><span class="err">│</span><span class="w">         </span><span class="n">geometry</span><span class="w">          </span><span class="err">│</span>
<span class="err">├────────────┼────────────────────────┼────────────┼───────────┼───────────────────────────┤</span>
<span class="err">│</span><span class="w"> </span><span class="mi">2967230</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">Ymare</span><span class="w">                  </span><span class="err">│</span><span class="w">       </span><span class="mi">1060</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">17938</span><span class="w"> </span><span class="mi">49</span><span class="p">.</span><span class="mi">3506</span><span class="p">)</span><span class="w">   </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">2967234</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">Yffiniac</span><span class="w">               </span><span class="err">│</span><span class="w">       </span><span class="mi">4392</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">.</span><span class="mi">67757</span><span class="w"> </span><span class="mi">48</span><span class="p">.</span><span class="mi">48479</span><span class="p">)</span><span class="w"> </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">2967350</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">Wimille</span><span class="w">                </span><span class="err">│</span><span class="w">       </span><span class="mi">4825</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">63137</span><span class="w"> </span><span class="mi">50</span><span class="p">.</span><span class="mi">76418</span><span class="p">)</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">2967414</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">Wavrechain</span><span class="o">-</span><span class="n">sous</span><span class="o">-</span><span class="n">Denain</span><span class="w"> </span><span class="err">│</span><span class="w">       </span><span class="mi">1769</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">.</span><span class="mi">41252</span><span class="w"> </span><span class="mi">50</span><span class="p">.</span><span class="mi">33224</span><span class="p">)</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">2967506</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="n">Walbourg</span><span class="w">               </span><span class="err">│</span><span class="w">       </span><span class="mi">1161</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="k">NULL</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="n">POINT</span><span class="w"> </span><span class="p">(</span><span class="mi">7</span><span class="p">.</span><span class="mi">78828</span><span class="w"> </span><span class="mi">48</span><span class="p">.</span><span class="mi">88628</span><span class="p">)</span><span class="w">  </span><span class="err">│</span>
<span class="err">└────────────┴────────────────────────┴────────────┴───────────┴───────────────────────────┘</span>
</code></pre></div>
<h3 id="utiliser-les-fonctions-spatiales-de-duckdb">Utiliser les fonctions spatiales de DuckDB</h3>
<p>L'objectif est d'ajouter une colonne départements à notre table des villes françaises de plus de 1 000 habitants, via une jointure spatiale.</p>
<p>Vous trouverez <a href="../assets/data/departements.geojson">ici</a> une couche des départements.</p>
<p>On va maintenant intégrer ce GeoJSON dans notre base de données. Pour cela, nous allons utiliser la fonction <code>st_read</code>, documentée <a href="https://duckdb.org/docs/stable/core_extensions/spatial/functions#st_read">ici</a>. Elle nous permet de lire un fichier spatial dans une clause <code>FROM</code> ; divers formats sont supportés grâce à l'utilisation de GDAL.</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">departement</span><span class="w"> </span><span class="k">AS</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">st_read</span><span class="p">(</span><span class="s1">&#39;/home/florent/perso/cours/docs/assets/data/departements.geojson&#39;</span><span class="p">);</span>
</code></pre></div>
<p>Vérifions que la table est bien intégrée.</p>
<div class="highlight"><pre><span></span><code><span class="n">D</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">departement</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">;</span>
<span class="err">┌────────────┬────────────┬──────────────────────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w"> </span><span class="n">DDEP_C_COD</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">DDEP_L_LIB</span><span class="w"> </span><span class="err">│</span><span class="w">      </span><span class="n">DREG_L_LIB</span><span class="w">      </span><span class="err">│</span><span class="w">                                                                                         </span><span class="n">geom</span><span class="w">                                                                                          </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nb">varchar</span><span class="w">   </span><span class="err">│</span><span class="w">  </span><span class="nb">varchar</span><span class="w">   </span><span class="err">│</span><span class="w">       </span><span class="nb">varchar</span><span class="w">        </span><span class="err">│</span><span class="w">                                                                                       </span><span class="n">geometry</span><span class="w">                                                                                        </span><span class="err">│</span>
<span class="err">├────────────┼────────────┼──────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w"> </span><span class="mi">01</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="n">Ain</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="n">Auvergne</span><span class="o">-</span><span class="n">Rhône</span><span class="o">-</span><span class="n">Alpes</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">POLYGON</span><span class="w"> </span><span class="p">((</span><span class="mi">6</span><span class="p">.</span><span class="mi">1684513</span><span class="w"> </span><span class="mi">46</span><span class="p">.</span><span class="mi">3674591</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">.</span><span class="mi">1666758</span><span class="w"> </span><span class="mi">46</span><span class="p">.</span><span class="mi">3707436</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">.</span><span class="mi">1609838</span><span class="w"> </span><span class="mi">46</span><span class="p">.</span><span class="mi">3765521</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">.</span><span class="mi">1471235</span><span class="w"> </span><span class="mi">46</span><span class="p">.</span><span class="mi">3798282</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">.</span><span class="mi">1204011</span><span class="w"> </span><span class="mi">46</span><span class="p">.</span><span class="mi">3959546</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">.</span><span class="mi">1065032</span><span class="w"> </span><span class="mi">46</span><span class="p">.</span><span class="mi">3998394</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">.</span><span class="mi">0975256</span><span class="w"> </span><span class="mi">46</span><span class="p">.</span><span class="mi">4082841</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">.</span><span class="mi">0640085</span><span class="w"> </span><span class="mi">46</span><span class="p">.</span><span class="mi">41</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w"> </span><span class="mi">02</span><span class="w">         </span><span class="err">│</span><span class="w"> </span><span class="n">Aisne</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="n">Hauts</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">France</span><span class="w">      </span><span class="err">│</span><span class="w"> </span><span class="n">POLYGON</span><span class="w"> </span><span class="p">((</span><span class="mi">4</span><span class="p">.</span><span class="mi">2557339</span><span class="w"> </span><span class="mi">49</span><span class="p">.</span><span class="mi">9039769</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">2369361</span><span class="w"> </span><span class="mi">49</span><span class="p">.</span><span class="mi">9037822</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">2336436</span><span class="w"> </span><span class="mi">49</span><span class="p">.</span><span class="mi">9091161</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">2221419</span><span class="w"> </span><span class="mi">49</span><span class="p">.</span><span class="mi">9104265</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">2177737</span><span class="w"> </span><span class="mi">49</span><span class="p">.</span><span class="mi">9162558</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">2202062</span><span class="w"> </span><span class="mi">49</span><span class="p">.</span><span class="mi">9335887</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">2321319</span><span class="w"> </span><span class="mi">49</span><span class="p">.</span><span class="mi">9559556</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">2330683</span><span class="w"> </span><span class="mi">49</span><span class="p">.</span><span class="mi">95</span><span class="err">…</span><span class="w">  </span><span class="err">│</span>
<span class="err">└────────────┴────────────┴──────────────────────┴───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span>
</code></pre></div>
<p>Ajoutons maintenant une colonne <code>code_dep</code> à notre table <code>villes_1000_hab_fr</code>.</p>
<p>Pour cela, deux solutions s'offrent à nous :</p>
<ul>
<li>Créer d'abord la colonne, puis la remplir via une instruction <code>UPDATE</code></li>
<li>Créer une nouvelle table et supprimer l'ancienne</li>
</ul>
<h4 id="option-1-creer-la-colonne-et-la-mettre-a-jour-ensuite">Option 1 : créer la colonne et la mettre à jour ensuite</h4>
<div class="highlight"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">villes_1000_hab_fr</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">code_dep</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">;</span>

<span class="k">UPDATE</span><span class="w"> </span><span class="n">villes_1000_hab_fr</span>
<span class="k">SET</span><span class="w"> </span><span class="n">code_dep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">DDEP_C_COD</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">departement</span><span class="w"> </span><span class="n">d</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">ST_Within</span><span class="p">(</span><span class="n">villes_1000_hab_fr</span><span class="p">.</span><span class="n">coordinates</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">geom</span><span class="p">);</span>
</code></pre></div>
<h4 id="option-2-nouvelle-table">Option 2 : nouvelle table</h4>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">villes_1000_hab_fr_new</span><span class="w"> </span><span class="k">AS</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">DDEP_C_COD</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">code_dep</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">villes_1000_hab_fr</span><span class="w"> </span><span class="n">v</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">departement</span><span class="w"> </span><span class="n">d</span>
<span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">ST_Within</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">coordinates</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">geom</span><span class="p">);</span>

<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">villes_1000_hab_fr</span><span class="p">;</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">villes_1000_hab_fr_new</span><span class="w"> </span><span class="k">RENAME</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">villes_1000_hab_fr</span><span class="p">;</span>
</code></pre></div>
<h2 id="exercice-3-utiliser-le-plugin-qgis-et-visualiser-nos-donnees">Exercice 3 : Utiliser le plugin QGIS et visualiser nos données</h2>
<h3 id="installer-le-plugin-qgis">Installer le plugin QGIS</h3>
<p>Depuis le gestionnaire des extensions QGIS.</p>
<p><img alt="Installation du plugin QGIS QDuckDB" src="../assets/img/qduckdb_install.png" /></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Si vous êtes sur <strong>Windows</strong>, le plugin intègre la dépendance Python <code>duckdb</code>, il n'y a donc rien à faire de plus. En revanche, si vous êtes sur macOS ou Linux, il faut consulter la <a href="https://oslandia.gitlab.io/qgis/qduckdb/usage/installation.html">documentation</a> du plugin.</p>
</div>
<h3 id="visualiser-dans-qgis-les-couches-realisees-dans-les-exercices-1-et-2">Visualiser dans QGIS les couches réalisées dans les exercices 1 et 2</h3>
<p>Dans votre barre des extensions de QGIS, vous trouverez une icône DuckDB qui lance l'interface du plugin. Chargez votre base de données.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>DuckDB ne connaît pas (encore) la projection des données, il est impératif de la préciser.</p>
</div>
<p><img alt="Fenêtre QDuckDB" src="../assets/img/dialog_qduckdb.png" /></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Nous avons créé nos tables sans préciser de schéma, elles se trouvent donc dans le schéma <code>main</code> (équivalent du schéma <code>public</code> de PostGIS).</p>
</div>
<p>Exemple de visualisation, notre couche <code>villes_1000_hab_fr</code> :</p>
<p><img alt="Visualisation d'une couche" src="../assets/img/layer_duckdb.png" /></p>
<h3 id="executer-des-selections-sql-depuis-le-plugin">Exécuter des sélections SQL depuis le plugin</h3>
<p>Depuis le plugin, il est possible de charger des couches via des requêtes SQL.</p>
<h4 id="chargement-des-villes-du-departement-35">Chargement des villes du département 35</h4>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span><span class="n">villes_1000_hab_fr</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">code_dep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;35&#39;</span>
</code></pre></div>
<p><img alt="Villes du 35" src="../assets/img/layer_35.png" /></p>
<h4 id="chargement-dune-couche-de-buffer-autour-des-points">Chargement d'une couche de buffer autour des points</h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Notre couche est en WGS84 (<code>EPSG:4326</code>). Si on effectue un buffer sans convertir vers une projection métrique, la distance sera exprimée en degrés. Il faut donc forcer une transformation en Lambert-93 à l'aide de la fonction <code>ST_Transform</code> et indiquer à QGIS que la couche est en <code>EPSG:2154</code>.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">population</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">ST_Buffer</span><span class="p">(</span><span class="n">ST_Transform</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span><span class="s1">&#39;EPSG:2154&#39;</span><span class="p">),</span><span class="w"> </span><span class="mi">10000</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">geom</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">villes_1000_hab_fr</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">code_dep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;35&#39;</span><span class="p">;</span>
</code></pre></div>
<p><img alt="Buffer de 10 km" src="../assets/img/layer_buffer.png" /></p>
<h2 id="exercice-4-traiter-des-donnees-parquet-doverture-maps-avec-duckdb">Exercice 4 : Traiter des données parquet d'Overture Maps avec DuckDB</h2>
<p><em>Cet exercice est issus de mon <a href="https://geotribu.fr/articles/2023/2023-12-19_duckdb-donnees-spatiales/">article</a> sur DuckDB publié sur Géotribu</em></p>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<p>Les données Overture Maps sont une base de données cartographique ouverte qui décrit des éléments du monde réel comme les routes, les bâtiments, les adresses ou les lieux.
Le projet est géré par la Overture Maps Foundation, une organisation créée par de grandes entreprises technologiques comme Amazon, Microsoft, Meta et TomTom,</p>
</div>
<p>Les données d’Overture Maps sont fournies sous forme de fichier Parquet (<a href="https://docs.overturemaps.org/overview/feature-model/">décrites ici</a>), nous allons donc importer ces données dans une base pour les consulter.</p>
<h3 id="importer-les-donnees-dans-la-base">Importer les données dans la base</h3>
<p>Dans cet exemple, on récupère 100 bâtiments aléatoirement.</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">buildings</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="k">type</span><span class="p">,</span><span class="w"> </span><span class="k">version</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="k">level</span><span class="p">,</span><span class="w"> </span><span class="k">class</span><span class="p">,</span><span class="w"> </span><span class="n">JSON</span><span class="p">(</span><span class="k">names</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">names</span><span class="p">,</span><span class="w"> </span><span class="n">JSON</span><span class="p">(</span><span class="n">sources</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sources</span><span class="p">,</span><span class="w"> </span><span class="n">geometry</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;s3://overturemaps-us-west-2/release/2026-01-21.0/theme=buildings/type=building/*.parquet&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">hive_partitioning</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
</code></pre></div>
<p>Dans cet autre exemple, on récupère les bâtiments d’une partie de la ville de Laval en indiquant les coordonnées d’un rectangle.</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">laval_buildings</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w"> </span>
<span class="k">SELECT</span>
<span class="w">    </span><span class="k">type</span><span class="p">,</span><span class="w"> </span><span class="k">version</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="k">level</span><span class="p">,</span><span class="w"> </span><span class="n">JSON</span><span class="p">(</span><span class="k">names</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">names</span><span class="p">,</span><span class="w"> </span><span class="n">JSON</span><span class="p">(</span><span class="n">sources</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sources</span><span class="p">,</span><span class="w"> </span><span class="n">geometry</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;s3://overturemaps-us-west-2/release/2026-01-21.0/theme=buildings/type=building/*.parquet&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">hive_partitioning</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span>
<span class="w">    </span><span class="n">bbox</span><span class="p">.</span><span class="n">xmin</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">7948129589175504</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">xmax</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">7472280816538276</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">ymin</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">48</span><span class="p">.</span><span class="mi">069335046027035</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">ymax</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">48</span><span class="p">.</span><span class="mi">073450034830316</span><span class="p">);</span>
</code></pre></div>
<h3 id="convertir-les-donnees-en-un-geojson-en-utilisant-duckdb">Convertir les données en un GeoJSON en utilisant DuckDB</h3>
<p>Un des atouts de DuckDB est qu'en plus d’intégrer des données pour les traiter en base, il peut servir d’outil de conversion pour des données Parquet. Exemple : si on me donne des données en Parquet et je souhaite des GeoJSON, DuckDB peut les convertir sans créer de table ni de base !</p>
<div class="highlight"><pre><span></span><code><span class="k">COPY</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span>
<span class="w">        </span><span class="k">type</span><span class="p">,</span><span class="k">version</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="k">level</span><span class="p">,</span><span class="w"> </span><span class="n">JSON</span><span class="p">(</span><span class="k">names</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">names</span><span class="p">,</span><span class="w"> </span><span class="n">JSON</span><span class="p">(</span><span class="n">sources</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sources</span><span class="p">,</span><span class="w"> </span><span class="n">geometry</span>
<span class="w">    </span><span class="k">FROM</span>
<span class="w">        </span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;s3://overturemaps-us-west-2/release/2026-01-21.0/theme=buildings/type=building/*.parquet&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">hive_partitioning</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span>
<span class="w">        </span><span class="n">bbox</span><span class="p">.</span><span class="n">xmin</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">7948129589175504</span>
<span class="w">        </span><span class="k">AND</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">xmax</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">7472280816538276</span>
<span class="w">        </span><span class="k">AND</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">ymin</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">48</span><span class="p">.</span><span class="mi">069335046027035</span>
<span class="w">        </span><span class="k">AND</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">ymax</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">48</span><span class="p">.</span><span class="mi">073450034830316</span><span class="p">)</span>
<span class="k">TO</span><span class="w"> </span><span class="s1">&#39;laval_buildings.geojson&#39;</span>
<span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">FORMAT</span><span class="w"> </span><span class="n">GDAL</span><span class="p">,</span><span class="w"> </span><span class="n">DRIVER</span><span class="w"> </span><span class="s1">&#39;GeoJSON&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">SRS</span><span class="w"> </span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">);</span>
</code></pre></div>
<p><img alt="💡" class="gemoji" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/1f4a1.svg" title=":bulb:" /> Il est également possible d'exporter en Shapefile, pour cela, il faut remplacer les deux dernières lignes par celles-ci :</p>
<div class="highlight"><pre><span></span><code><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;laval_buildings.shp&#39;</span>
<span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">FORMAT</span><span class="w"> </span><span class="n">GDAL</span><span class="p">,</span><span class="w"> </span><span class="n">DRIVER</span><span class="w"> </span><span class="s1">&#39;ESRI Shapefile&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">SRS</span><span class="w"> </span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">);</span>
</code></pre></div>
<h2 id="exercice-5-duckdb-avec-lopen-data-de-rennes-metropole">Exercice 5 : DuckDB avec l'Open Data de Rennes Métropole</h2>
<p>Le <a href="https://data.rennesmetropole.fr/pages/home/">portail Open Data de Rennes Métropole</a> fournit les données au format Parquet.</p>
<ul>
<li>Intégrez dans une base DuckDB deux couches de votre choix</li>
<li>Utilisez les fonctions spatiales de DuckDB pour croiser spatialement ces données</li>
<li>Chargez le résultat dans QGIS à l'aide du plugin QDuckDB</li>
</ul>
<h3 id="correction">Correction</h3>
<p>On récupère les couches station de métro et iris. On enrichie la couche des stations de métro avec le code IRIS.</p>
<div class="highlight"><pre><span></span><code><span class="n">INSTALL</span><span class="w"> </span><span class="n">spatial</span><span class="w"> </span><span class="p">;</span>
<span class="k">LOAD</span><span class="w"> </span><span class="n">spatial</span><span class="w"> </span><span class="p">;</span>

<span class="k">SET</span><span class="w"> </span><span class="n">force_download</span><span class="o">=</span><span class="k">true</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">station_metro</span><span class="w"> </span><span class="k">AS</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;https://data.rennesmetropole.fr/api/explore/v2.1/catalog/datasets/metro_localisation_stations/exports/parquet?lang=fr&amp;timezone=Europe%2FBerlin&#39;</span><span class="p">)</span>
<span class="p">;</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">station_metro</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">COLUMN</span><span class="w">  </span><span class="n">geo_point_2d</span><span class="w"> </span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">iris</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;https://data.rennesmetropole.fr/api/explore/v2.1/catalog/datasets/iris_version_rennes_metropole/exports/parquet?lang=fr&amp;timezone=Europe%2FBerlin&#39;</span><span class="p">);</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">station_metro</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">iris</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="p">;</span><span class="w"> </span>

<span class="k">UPDATE</span><span class="w"> </span><span class="n">station_metro</span>
<span class="k">SET</span><span class="w"> </span><span class="n">iris</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">code_iris</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">iris</span><span class="w"> </span><span class="n">d</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">ST_Within</span><span class="p">(</span><span class="n">station_metro</span><span class="p">.</span><span class="n">geo_shape</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">geo_shape</span><span class="p">);</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.hide", "navigation.instant", "navigation.instant.progress", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "toc.follow", "toc.integrate", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>